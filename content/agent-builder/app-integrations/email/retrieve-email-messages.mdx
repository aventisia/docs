import { Callout, Steps } from "nextra/components";

# Retrieve Email Messages

The **Retrieve Email Messages** node allows you to access and retrieve email messages from your email account using the IMAP protocol. It can connect to your email server, authenticate your credentials, and allow you to filter and retrieve emails based on several criteria such as unread emails, specific senders, or keywords in the subject or body. This node is useful for automating email handling, such as reading notifications, extracting data from emails, and downloading attachments.

{/* ![Retrieve Email Messages](./retrieve-email-messages.png) */}

## Configuration Options

| Field Name                        | Description                                                                                | Input Type | Required? | Default Value        |
| --------------------------------- | ------------------------------------------------------------------------------------------ | ---------- | --------- | -------------------- |
| **IMAP Server**                   | The IMAP server URL.                                                                       | Text       | Yes       | _(empty)_            |
| **Username**                      | The username for authentication.                                                           | Text       | Yes       | _(empty)_            |
| **Password**                      | The password for authentication.                                                           | Text       | Yes       | _(empty)_            |
| **Port**                          | The port number for the IMAP server (default is 993).                                      | Text       | No        | 993                  |
| **Enable SSL**                    | If true, uses SSL encryption for the connection.                                           | Switch     | No        | True                 |
| **Accept Untrusted Certificates** | If true, accepts untrusted SSL certificates.                                               | Switch     | No        | False                |
| **Mail Folder**                   | The folder to retrieve emails from (e.g., Inbox).                                          | Text       | No        | Inbox                |
| **Retrieve Mode**                 | Specifies which emails to retrieve.                                                        | Select     | No        | AllEmails            |
| **Mark as Read**                  | If true, marks retrieved emails as read.                                                   | Switch     | No        | False                |
| **From Field Contains**           | Filters emails where the 'From' field contains this text.                                  | Text       | No        | _(empty)_            |
| **To Field Contains**             | Filters emails where the 'To' field contains this text.                                    | Text       | No        | _(empty)_            |
| **Subject Contains**              | Filters emails where the subject contains this text.                                       | Text       | No        | _(empty)_            |
| **Body Contains**                 | Filters emails where the body contains this text.                                          | Text       | No        | _(empty)_            |
| **Save Attachments**              | Specifies whether to save attachments.                                                     | Select     | No        | DoNotSaveAttachments |
| **Save Attachments Into**         | The directory where attachments will be saved (required if 'Save Attachments' is enabled). | Text       | No        | _(empty)_            |

## Expected Output Format

The output of this node is **a list of email messages**, each containing details such as sender, recipient, subject, and body. If attachments are saved, they are stored in the specified directory.

## Step-by-Step Guide

<Steps>
### Step 1

Add **Retrieve Email Messages** node into your flow.

### Step 2

Enter the **IMAP Server** URL for your email provider (e.g., `imap.gmail.com`).

### Step 3

Input your **Username** and **Password** to allow the node to access your emails.

### Step 4

Specify the **Port** if different from the default port `993` for secure connections.

### Step 5

Decide whether to **Enable SSL**. For secure connections, it should be `True`.

### Step 6

Choose if you want to **Accept Untrusted Certificates** when connecting using SSL.

### Step 7

Select the **Mail Folder** to retrieve emails from, such as `Inbox`.

### Step 8

Set the **Retrieve Mode** to determine which emails are retrieved (e.g., all emails, unread only).

### Step 9

(Optional) Use the **From Field Contains**, **To Field Contains**, **Subject Contains**, or **Body Contains** to filter specific emails based on desired content.

### Step 10

(Optional) If attachments need to be saved, choose **Save Attachments** and specify the **Save Directory**.

### Step 11

The retrieved emails will be available as **RetrievedEmails** for further use in your flow.

</Steps>

<Callout type="info" title="Important Note">
  Ensure that your email server settings allow access via IMAP and that
  credentials entered are valid, as incorrect information will prevent email
  retrieval.
</Callout>

## Input/Output Examples

| Retrieve Mode | From Contains      | Subject Contains | Output                                                                    |
| ------------- | ------------------ | ---------------- | ------------------------------------------------------------------------- |
| AllEmails     | _(none)_           | _(none)_         | List of emails                                                            |
| UnreadOnly    | example@domain.com | Invoice          | List of unread emails with "Invoice" in subject from "example@domain.com" |

## Common Mistakes & Troubleshooting

| Problem                                  | Solution                                                                                                  |
| ---------------------------------------- | --------------------------------------------------------------------------------------------------------- |
| **Unable to connect to the IMAP server** | Check that the IMAP server URL, port, and SSL settings are correct and reachable.                         |
| **Authentication failed**                | Ensure the Username and Password are correct. Consider any special characters that may affect the input.  |
| **Retrieved emails not as expected**     | Verify filter settings under 'From Field Contains', 'Subject Contains', and other conditions are correct. |
| **Attachments not saving**               | Ensure the "Save Attachments" option is activated and that a valid directory is specified.                |

## Real-World Use Cases

- **Automated Email Summary**: Automatically collect unread email summaries for daily reports or dashboards.
- **Customer Support**: Retrieve and categorize client emails automatically, marking them as read post-processing.
- **Invoice Processing**: Filter and download invoices from a specific sender, saving attachments for processing.
- **Email Marketing**: Extract leads from emails with specific subject lines or bodies, streamlining data entry.
